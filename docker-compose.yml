version: '3.8'
services:
  aggregator:
    build:
      context: .
      dockerfile: docker/Dockerfile.aggregator
    image: aggregator-service:v1.0.5
    container_name: aggregator
    ports:
      - "50051:50051"
    networks:
      - trading-net
    restart: unless-stopped

  client-bbo:
    build:
      context: .
      dockerfile: docker/Dockerfile.client-bbo
    image: client-bbo:v1.0.6
    container_name: client-bbo
    command: ["aggregator:50051"]
    depends_on:
      - aggregator
    restart: unless-stopped
    networks:
      - trading-net

  client-volume-bands:
    # 假设 volume-bands 的 Dockerfile 也在 docker/ 目录下
    build:
      context: .
      dockerfile: docker/Dockerfile.client-volumebands
    image: client-volumebands:v1.0.6      # 建议统一版本号
    container_name: client-volumebands
    command: ["aggregator:50051"]
    depends_on:
      - aggregator
    networks:
      - trading-net

  client-price-bands:
    # 假设 price-bands 的 Dockerfile 也在 docker/ 目录下
    build:
      context: .
      dockerfile: docker/Dockerfile.client-pricebands
    image: client-pricebands:v1.0.6       # 建议统一版本号
    container_name: client-pricebands
    command: ["aggregator:50051"]
    depends_on:
      - aggregator
    networks:
      - trading-net

networks:
  trading-net:
    driver: bridge
